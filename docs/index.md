# Magic Pocket

magic-pocket は Django を、AWS lambda 環境にデプロイするためのライブラリです。
AWS lambda + neon postgres という環境をターゲットとし、ストレージには S3 を利用します。
S3 と route53 以外は、AWS のリソースはクラウドフォーメーションで作成するため、作成された環境の理解も簡単です。

## Motivation

複数の個人プロジェクトを同時に運用するため、インフラ構築を共通化するために作成しました。
その際に重視した条件は、以下 2 点です。

- サーバ管理を自分で行わない
- 未使用時にはコストがかからない

そのため、AWS lambda を利用することにしたのですが、同じ設定を何箇所にも書く必要があり、管理が煩雑になりました。新しいプロジェクトを始める際も、コピペの箇所を間違えてしまい動かない、ということが多々あり、Todo をまとめるぐらいなら、ライブラリにしてしまおう、ということになりました。

また、インフラ設定の記述方法については、環境ごとの差を 1 つのファイルで簡単に管理したい、ということもあり、toml で記述することにしました。toml で書ききれない設定は追加しない、ということで、設定の簡略化を図っています。出来ているかは不明です。

## Features

以下の様な機能があります。

- neon API を利用した DB 環境の構築と AWS secretsmanager への接続情報登録
- lambda から上記 DB 情報を自動読み込み
- lambda から django management command を実行
- S3 バケットの作成と、django の STORAGES 設定
- API Gateway の作成と、django の ALLOWED_HOSTS 設定
- SPA のフロントエンドアップロード先の作成
- デプロイ時の環境変数の設定
